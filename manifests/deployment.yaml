apiVersion: apps/v1
kind: Deployment
metadata:
  name: project-argocd
  namespace: project-argocd-dev
  labels:
    app.kubernetes.io/name: project-argocd
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: project-argocd
  template:
    metadata:
      labels:
        app.kubernetes.io/name: project-argocd
    spec:
      containers:
        - name: web
          # üëá ƒê·∫∂T L·∫†I image n√†y cho ƒë√∫ng registry c·ªßa b·∫°n
          # v√≠ d·ª• khi b·∫°n push l√™n Docker Hub: docker.io/haovn2411/projectargocd:latest
          image: docker.io/haovn2411/argocd:main
          imagePullPolicy: Always

          # .NET 8 Kestrel m·∫∑c ƒë·ªãnh l·∫Øng c·ªïng 8080 khi set ASPNETCORE_URLS
          env:
            - name: ASPNETCORE_URLS
              value: http://0.0.0.0:5000
            - name: ASPNETCORE_ENVIRONMENT
              value: Development   # <‚Äî th√™m d√≤ng n√†y

          ports:
            - name: http
              containerPort: 5000

                    # Probes g·ªçi t·ªõi /healthz cho ·ªïn ƒë·ªãnh (√≠t thay ƒë·ªïi logic)
          readinessProbe:
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 5     # app kh·ªüi ƒë·ªông r·∫•t nhanh; n·∫øu c·∫ßn tƒÉng l√™n 10‚Äì15
            periodSeconds: 10
            timeoutSeconds: 2
            failureThreshold: 3

          livenessProbe:
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 10
            periodSeconds: 20
            timeoutSeconds: 2
            failureThreshold: 3

          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 250m
              memory: 256Mi